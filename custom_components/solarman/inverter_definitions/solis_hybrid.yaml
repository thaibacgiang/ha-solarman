info:
  manufacturer: Hinen
  model: H5000

default:
  update_interval: 30
  code: 0x04
  digits: 4

parameters:
  ###############################################
  # SWITCH - Controls
  ###############################################
  - group: Controls
    update_interval: 300
    items:
      - name: "Solar Sell"
        platform: "switch"
        rule: 1
        registers: [125]  # Energy Pattern register - giả sử bit 0 là solar sell
        bitmask: 0x0001
        icon: "mdi:toggle-switch"
        entity_category: config

      - name: "Grid Charge"
        platform: "switch"
        rule: 1
        registers: [125]  # Giả sử bit 1 là grid charge
        bitmask: 0x0002
        icon: "mdi:toggle-switch"
        entity_category: config

  ###############################################
  # BINARY SENSOR - Relays
  ###############################################
  - group: Relays
    update_interval: 5
    items:
      - name: "AC INV Relay"
        platform: "binary_sensor"
        rule: 1
        registers: [0]  # Cần kiểm tra register chính xác
        bitmask: 0x0001
        icon: "mdi:relay"

      - name: "AC Grid Relay"
        platform: "binary_sensor"
        rule: 1
        registers: [0]  # Cần kiểm tra register chính xác
        bitmask: 0x0004
        icon: "mdi:transmission-tower"

  ###############################################
  # TEXT SENSOR - Status
  ###############################################
  - group: Status
    update_interval: 5
    items:
      - name: "Running Status"
        platform: "text_sensor"
        rule: 1
        registers: [0]
        icon: "mdi:state-machine"
        lookup:
          - key: 0
            value: "Stand-by"
          - key: 1
            value: "Grid-connected"
          - key: 2
            value: "Off-grid"
          - key: 3
            value: "FAULT"
          - key: 4
            value: "Update mode"
          - key: 5
            value: "Charging"
          - key: 6
            value: "Discharging"
          - key: 7
            value: "Bypass"

  ###############################################
  # NUMBER - Settings
  ###############################################
  - group: Battery_Settings
    update_interval: 300
    items:
      - name: "Maximum Battery Charge Current"
        platform: "number"
        rule: 1
        registers: [210]
        uom: "A"
        min: 0
        max: 185
        step: 5
        icon: "mdi:battery-charging"

      - name: "Maximum Battery Discharge Current"
        platform: "number"
        rule: 1
        registers: [211]
        uom: "A"
        min: 0
        max: 185
        step: 5
        icon: "mdi:battery-minus"

  ###############################################
  # SENSOR - PV System
  ###############################################
  - group: PV
    update_interval: 5
    items:
      - name: "PV Power"
        class: "power"
        state_class: "measurement"
        uom: "W"
        scale: 0.1
        rule: 2
        registers: [340, 339]
        icon: "mdi:solar-power-variant"

      - name: "PV1 Power"
        class: "power"
        state_class: "measurement"
        uom: "W"
        rule: 1
        registers: [7, 6]
        icon: "mdi:solar-power-variant"

      - name: "PV2 Power"
        class: "power"
        state_class: "measurement"
        uom: "W"
        rule: 1
        registers: [12, 11]
        icon: "mdi:solar-power-variant"

      - name: "PV1 Voltage"
        class: "voltage"
        state_class: "measurement"
        uom: "V"
        scale: 0.1
        rule: 1
        registers: [3]
        icon: "mdi:solar-power-variant"

      - name: "PV2 Voltage"
        class: "voltage"
        state_class: "measurement"
        uom: "V"
        scale: 0.1
        rule: 1
        registers: [8]
        icon: "mdi:solar-power-variant"

      - name: "PV1 Current"
        class: "current"
        state_class: "measurement"
        uom: "A"
        scale: 0.1
        rule: 1
        registers: [4]
        icon: "mdi:solar-power-variant"

      - name: "PV2 Current"
        class: "current"
        state_class: "measurement"
        uom: "A"
        scale: 0.1
        rule: 1
        registers: [9]
        icon: "mdi:solar-power-variant"

  ###############################################
  # SENSOR - Battery
  ###############################################
  - group: Battery
    update_interval: 5
    items:
      - name: "Battery Temperature"
        class: "temperature"
        state_class: "measurement"
        uom: "°C"
        scale: 0.1
        rule: 1
        registers: [136]
        icon: "mdi:thermometer"

      - name: "Battery Voltage"
        class: "voltage"
        state_class: "measurement"
        uom: "V"
        scale: 0.1
        rule: 1
        registers: [127]
        icon: "mdi:flash"

      - name: "Battery SOC"
        class: "battery"
        state_class: "measurement"
        uom: "%"
        rule: 1
        registers: [128]
        icon: "mdi:home-battery"

      - name: "Battery Power"
        class: "power"
        state_class: "measurement"
        uom: "W"
        scale: 0.1
        rule: 2
        registers: [105, 104]  # Charge power
        icon: "mdi:battery-plus"

      - name: "Battery Discharge Power"
        class: "power"
        state_class: "measurement"
        uom: "W"
        scale: 0.1
        rule: 2
        registers: [103, 102]  # Discharge power
        icon: "mdi:battery-minus"

  ###############################################
  # SENSOR - Grid
  ###############################################
  - group: Grid
    update_interval: 5
    items:
      - name: "Grid Voltage"
        class: "voltage"
        state_class: "measurement"
        uom: "V"
        scale: 0.1
        rule: 1
        registers: [29]
        icon: "mdi:transmission-tower"

      - name: "Grid Current"
        class: "current"
        state_class: "measurement"
        uom: "A"
        scale: 0.1
        rule: 1
        registers: [30]
        icon: "mdi:current-ac"

      - name: "Grid Frequency"
        class: "frequency"
        state_class: "measurement"
        uom: "Hz"
        scale: 0.01
        rule: 2
        registers: [56]
        icon: "mdi:sine-wave"

      - name: "Grid Power"
        class: "power"
        state_class: "measurement"
        uom: "W"
        rule: 1
        registers: [77, 76]
        icon: "mdi:transmission-tower"

  ###############################################
  # SENSOR - Load
  ###############################################
  - group: Load
    update_interval: 5
    items:
      - name: "Load Power"
        class: "power"
        state_class: "measurement"
        uom: "W"
        scale: 0.1
        rule: 2
        registers: [77, 76]
        icon: "mdi:home-lightning-bolt"

  ###############################################
  # SENSOR - Energy
  ###############################################
  - group: Energy
    update_interval: 30
    items:
      - name: "Today Production"
        alt: "Daily Production"
        class: "energy"
        state_class: "total_increasing"
        uom: "kWh"
        scale: 0.1
        rule: 2
        registers: [273, 272]
        icon: "mdi:solar-power"

      - name: "Total Production"
        class: "energy"
        state_class: "total_increasing"
        uom: "kWh"
        scale: 0.1
        rule: 2
        registers: [275, 274]
        icon: "mdi:solar-power"

      - name: "Today Battery Charge"
        class: "energy"
        state_class: "total_increasing"
        uom: "kWh"
        scale: 0.1
        rule: 2
        registers: [277, 276]
        icon: "mdi:battery-plus"

      - name: "Total Battery Charge"
        class: "energy"
        state_class: "total_increasing"
        uom: "kWh"
        scale: 0.1
        rule: 2
        registers: [279, 278]
        icon: "mdi:battery-plus"

      - name: "Today Battery Discharge"
        class: "energy"
        state_class: "total_increasing"
        uom: "kWh"
        scale: 0.1
        rule: 2
        registers: [281, 280]
        icon: "mdi:battery-minus"

      - name: "Total Battery Discharge"
        class: "energy"
        state_class: "total_increasing"
        uom: "kWh"
        scale: 0.1
        rule: 2
        registers: [283, 282]
        icon: "mdi:battery-minus"

      - name: "Today Load Consumption"
        class: "energy"
        state_class: "total_increasing"
        uom: "kWh"
        scale: 0.1
        rule: 2
        registers: [301, 300]
        icon: "mdi:home-lightning-bolt"

      - name: "Total Load Consumption"
        class: "energy"
        state_class: "total_increasing"
        uom: "kWh"
        scale: 0.1
        rule: 2
        registers: [303, 302]
        icon: "mdi:home-lightning-bolt"

      - name: "Today Energy Export"
        class: "energy"
        state_class: "total_increasing"
        uom: "kWh"
        scale: 0.1
        rule: 2
        registers: [305, 304]
        icon: "mdi:transmission-tower-export"

      - name: "Total Energy Export"
        class: "energy"
        state_class: "total_increasing"
        uom: "kWh"
        scale: 0.1
        rule: 2
        registers: [307, 306]
        icon: "mdi:transmission-tower-export"

      - name: "Today Energy Import"
        class: "energy"
        state_class: "total_increasing"
        uom: "kWh"
        scale: 0.1
        rule: 2
        registers: [309, 308]
        icon: "mdi:transmission-tower-import"

      - name: "Total Energy Import"
        class: "energy"
        state_class: "total_increasing"
        uom: "kWh"
        scale: 0.1
        rule: 2
        registers: [311, 310]
        icon: "mdi:transmission-tower-import"

  ###############################################
  # SELECT - Settings
  ###############################################
  - group: System_Settings
    update_interval: 300
    items:
      - name: "Energy Pattern"
        platform: "select"
        rule: 1
        registers: [125]
        icon: "mdi:battery-sync"
        lookup:
          - key: 0
            value: "Load"
          - key: 1
            value: "Battery"
          - key: 2
            value: "Grid"

      - name: "Battery Control Mode"
        platform: "select"
        rule: 1
        registers: [126]
        icon: "mdi:battery"
        lookup:
          - key: 0x0000
            value: "Lead-Battery"
          - key: 0x0001
            value: "Lithium"

  ###############################################
  # INFO - Device Info
  ###############################################
  - group: Info
    update_interval: 3600
    items:
      - name: "Battery Software Version"
        rule: 1
        registers: [170]
        icon: "mdi:information"
