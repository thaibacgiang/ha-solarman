#
# Deye | Hybrid Inverter
#
# Reference: https://github.com/user-attachments/files/16597960/Deye.Modbus.protocol.V118.pdf
#
# Tested
#

info:
  manufacturer: Deye
  model: SG0*LP1

default:
  update_interval: 5
  digits: 6

parameters:
  - group: Info
    update_interval: 3600
    items:
      - name: "Device"
        class: "enum"
        rule: 1
        registers: [0]
        icon: "mdi:information"
        lookup:
          - key: 0
            value: "Unknown"
          - key: [2, 512]
            value: "String Inverter"
          - key: [3, 768]
            value: "Single-Phase Hybrid Inverter"
          - key: [4, 1024]
            value: "Microinverter"
          - key: [5, 1280]
            value: "LV 3-Phase Hybrid Inverter"
          - key: 6
            value: "HV 3-Phase Hybrid Inverter"
          - key: [7, 1536]
            value: "HV 3-Phase Inverter 6-15kw"
          - key: [8, 1537]
            value: "HV 3-Phase Inverter 20-50kw"
          - key: 259
            value: "Off-Grid Inverter"
          - key: 260
            value: "Energy Storage System"
        attributes:
          [
            "Device Modbus Address",
            "Device Protocol Version",
            "Device Serial Number",
            "Device Rated Phase",
            "Device Chip Type",
            "Device Control Board Firmware Version",
            "Device Communication Board Firmware Version",
            "Device Rated Power",
            "Device MPPTs",
            "Device Phases",
          ]

      - name: "Device Modbus Address"
        attribute:
        rule: 1
        registers: [1]

      - name: "Device Protocol Version"
        attribute:
        rule: 7
        remove: "0."
        registers: [2]

      - name: "Device Serial Number"
        attribute:
        rule: 5
        registers: [3, 4, 5, 6, 7]

      - name: "Device Rated Phase"
        attribute:
        class: "enum"
        rule: 1
        registers: [8]
        lookup:
          - key: [0, 1, 2]
            value: "Single-Phase"
          - key: 3
            value: "Three-Phase"
          - key: 8
            value: "Single-Phase Storage"

      - name: "Device Chip Type"
        attribute:
        class: "enum"
        rule: 1
        registers: [9]
        lookup:
          - key: 0
            value: "AT32F403A"
          - key: 1
            value: "SXX32F103"
          - key: 2
            value: "GD32F103"
          - key: 3
            value: "GD32F303"

      - name: "Device Control Board Firmware Version"
        attribute:
        rule: 7
        delimiter: ""
        registers: [13, 12, 11]

      - name: "Device Communication Board Firmware Version"
        attribute:
        rule: 7
        hex:
        delimiter: ""
        registers: [14, 10]

      - name: "Device Rated Power"
        attribute:
        class: "power"
        state_class: "measurement"
        uom: "W"
        scale: 0.1
        rule: 4
        registers: [16, 17]
        validation:
          min: 1
          max: 18000
          default: 18000

      - name: "Device MPPTs"
        attribute:
        rule: 1
        mask: 3840
        divide: 256
        registers: [18]
        range:
          min: 257
        validation:
          max: 12
          default: 2

      - name: "Device Phases"
        attribute:
        rule: 1
        mask: 15
        registers: [18]
        range:
          min: 257
        validation:
          max: 3
          default: 3

  - group: Control
    update_interval: 5
    items:
      - name: "Self-check time"
        platform: number
        update_interval: 300
        uom: "s"
        rule: 1
        registers: [21]
        range:
          min: 0
          max: 1000
          default: 0

      - name: "Date & Time"
        platform: datetime
        update_interval: 60
        rule: 8
        registers: [22, 23, 24]

      - name: "" # On/Off Switch (Empty name so the sensor has same name as the device, looks good! Can be used once per platform though)
        platform: switch
        update_interval: 30
        rule: 1
        registers: [43]
        value:
          on: 1
          off: 2

      - name: "Device State"
        class: "enum"
        update_interval: 10
        rule: 1
        registers: [59]
        icon: "mdi:state-machine"
        range:
          min: 0
          max: 5
        lookup:
          - key: 0
            value: "Standby"
          - key: 1
            value: "Self-test"
          - key: 2
            value: "Normal"
          - key: 3
            value: "Alarm"
          - key: 4
            value: "Fault"

      - name: "Device Alarm"
        class: "enum"
        rule: 3
        registers: [101, 102]
        icon: "mdi:alert-outline"
        lookup:
          - key: 0
            value: "OK"
          - bit: 1
            value: "Fan failure"
          - bit: 2
            value: "Grid phase failure"
          - bit: 3
            value: "Meter communication failure"
          - bit: 30
            value: "Battery loss"
          - bit: 31
            value: "Parallel communication quality"
          - key: default
            value: Problem

      - name: "Device Fault"
        class: "enum"
        rule: 3
        registers: [103, 104, 105, 106]
        icon: "mdi:message-alert-outline"
        lookup:
          - key: 0
            value: "OK"
          - bit: 6
            value: "DC/DC Soft Start failure"
          - bit: 9
            value: "Auxiliary power supply failure"
          - bit: 12
            value: "Working mode changed"
          - bit: 17
            value: "AC Over-current failure"
          - bit: 18
            value: "Tz_Integ_Fault failure"
          - bit: 19
            value: "DC Over-current failure"
          - bit: 22
            value: "AC current leakage failure"
          - bit: 63
            value: "Temperature is too high"
          - key: default
            value: Problem

  - group: PV
    update_interval: 5
    items:
      - name: "PV Power"
        alt: DC Power
        mppt: 1
        description: Combined power of all inputs
        class: "power"
        state_class: "measurement"
        uom: "W"
        rule: 1
        digits: 0
        sensors:
          - registers: [186]
          - registers: [187]
          - registers: [188]
          - registers: [189]
        validation:
          min: 0
          max: 36000
          invalidate_all:
        icon: "mdi:solar-power-variant"

      - name: "PV1 Voltage"
        alt: DC1 Voltage
        mppt: 1
        class: "voltage"
        state_class: "measurement"
        uom: "V"
        scale: 0.1
        rule: 1
        registers: [109]
        icon: "mdi:solar-power-variant"

      - name: "PV1 Current"
        alt: DC1 Current
        mppt: 1
        class: "current"
        uom: "A"
        scale: 0.1
        rule: 1
        registers: [110]
        icon: "mdi:solar-power-variant"

      - name: "PV2 Voltage"
        alt: DC2 Voltage
        mppt: 2
        class: "voltage"
        state_class: "measurement"
        uom: "V"
        scale: 0.1
        rule: 1
        registers: [111]
        icon: "mdi:solar-power-variant"

      - name: "PV2 Current"
        alt: DC2 Current
        mppt: 2
        class: "current"
        state_class: "measurement"
        uom: "A"
        scale: 0.1
        rule: 1
        registers: [112]
        icon: "mdi:solar-power-variant"

      - name: "PV3 Voltage"
        alt: DC3 Voltage
        mppt: 3
        class: "voltage"
        state_class: "measurement"
        uom: "V"
        scale: 0.1
        rule: 1
        registers: [113]
        icon: "mdi:solar-power-variant"

      - name: "PV3 Current"
        alt: DC3 Current
        mppt: 3
        class: "current"
        state_class: "measurement"
        uom: "A"
        scale: 0.1
        rule: 1
        registers: [114]
        icon: "mdi:solar-power-variant"

      - name: "PV4 Voltage"
        alt: DC4 Voltage
        mppt: 4
        class: "voltage"
        state_class: "measurement"
        uom: "V"
        scale: 0.1
        rule: 1
        registers: [115]
        icon: "mdi:solar-power-variant"

      - name: "PV4 Current"
        alt: "DC4 Current"
        mppt: 4
        class: "current"
        state_class: "measurement"
        uom: "A"
        scale: 0.1
        rule: 1
        registers: [116]
        icon: "mdi:solar-power-variant"

      - name: "PV1 Power"
        alt: DC1 Power
        mppt: 1
        class: "power"
        state_class: "measurement"
        uom: "W"
        rule: 1
        registers: [186]
        icon: "mdi:solar-power-variant"

      - name: "PV2 Power"
        alt: DC2 Power
        mppt: 2
        class: "power"
        state_class: "measurement"
        uom: "W"
        rule: 1
        registers: [187]
        icon: "mdi:solar-power-variant"

      - name: "PV3 Power"
        alt: DC3 Power
        mppt: 3
        class: "power"
        state_class: "measurement"
        uom: "W"
        rule: 1
        registers: [188]
        icon: "mdi:solar-power-variant"

      - name: "PV4 Power"
        alt: DC4 Power
        mppt: 4
        class: "power"
        state_class: "measurement"
        uom: "W"
        rule: 1
        registers: [189]
        icon: "mdi:solar-power-variant"

  - group: Meter
    update_interval: 30
    items:
      - name: "Today Energy"
        alt: Daily Energy
        friendly_name: Today's Energy
        class: "energy"
        state_class: "total"
        uom: "kWh"
        scale: 0.1
        rule: 2
        registers: [60]

      - name: "Total Energy"
        class: "energy"
        state_class: "total"
        uom: "kWh"
        scale: 0.1
        rule: 4
        registers: [63, 64]

      - name: "Today Battery Charge"
        friendly_name: Today's Battery Charge
        class: "energy"
        state_class: "total_increasing"
        uom: "kWh"
        scale: 0.1
        rule: 1
        registers: [70]
        icon: "mdi:battery-plus"

      - name: "Today Battery Discharge"
        friendly_name: Today's Battery Discharge
        class: "energy"
        state_class: "total_increasing"
        uom: "kWh"
        scale: 0.1
        rule: 1
        registers: [71]
        icon: "mdi:battery-minus"

      - name: "Total Battery Charge"
        class: "energy"
        state_class: "total_increasing"
        uom: "kWh"
        scale: 0.1
        rule: 3
        registers: [72, 73]
        icon: "mdi:battery-plus"
        validation:
          min: 0.1

      - name: "Total Battery Discharge"
        class: "energy"
        state_class: "total_increasing"
        uom: "kWh"
        scale: 0.1
        rule: 3
        registers: [74, 75]
        icon: "mdi:battery-minus"
        validation:
          min: 0.1

      - name: Today Energy Import
        alt: Today Energy Bought
        friendly_name: Today's Energy Import
        class: "energy"
        state_class: "total_increasing"
        uom: "kWh"
        scale: 0.1
        rule: 1
        registers: [76]
        icon: "mdi:transmission-tower-export"

      - name: Today Energy Export
        alt: Today Energy Sold
        friendly_name: Today's Energy Export
        class: "energy"
        state_class: "total_increasing"
        uom: "kWh"
        scale: 0.1
        rule: 1
        registers: [77]
        icon: "mdi:transmission-tower-import"

      - name: Total Energy Import
        alt: Total Energy Bought
        class: "energy"
        state_class: "total_increasing"
        uom: "kWh"
        scale: 0.1
        rule: 1
        registers: [78, 80]
        icon: "mdi:transmission-tower-export"
        validation:
          min: 0.1

      - name: Total Energy Export
        alt: Total Energy Sold
        class: "energy"
        state_class: "total_increasing"
        uom: "kWh"
        scale: 0.1
        rule: 3
        registers: [81, 82]
        icon: "mdi:transmission-tower-import"
        validation:
          min: 0.1

      - name: "Today Load Consumption"
        friendly_name: Today's Load Consumption
        class: "energy"
        state_class: "total_increasing"
        uom: "kWh"
        scale: 0.1
        rule: 1
        registers: [84]

      - name: "Total Load Consumption"
        class: "energy"
        state_class: "total_increasing"
        uom: "kWh"
        scale: 0.1
        rule: 3
        registers: [85, 86]
        validation:
          min: 0.1

      - name: Generator Energy - today
        name_lookup: "io_mode_select"
        class: "energy"
        state_class: "total_increasing"
        uom: "kWh"
        scale: 0.1
        rule: 1
        registers: [62]

      - name: Generator Energy
        name_lookup: "io_mode_select"
        class: "energy"
        state_class: "total_increasing"
        uom: "kWh"
        scale: 0.1
        rule: 3
        registers: [92, 95]
        validation:
          min: 0.1

      - name: "Today Production"
        friendly_name: Today's Production
        class: "energy"
        state_class: "total_increasing"
        uom: "kWh"
        scale: 0.1
        rule: 1
        registers: [108]
        icon: "mdi:solar-power"
        validation:
          dev: 100
          invalidate_all:

      - name: "Total Production"
        class: "energy"
        state_class: "total_increasing"
        uom: "kWh"
        scale: 0.1
        rule: 3
        registers: [96, 97]
        icon: "mdi:solar-power"
        validation:
          min: 0.1
          dev: 100
          invalidate_all: 2

      - name: Today Losses
        alt: Daily Losses
        friendly_name: Today's Losses
        description: Includes today's consumption of the inverter device itself as well AC/DC conversion losses
        class: "energy"
        state_class: "total_increasing"
        ensure_increasing:
        uom: "kWh"
        rule: 1
        digits: 1
        scale: 0.1
        uint: enforce
        sensors:
          - registers: [76]
          - registers: [108]
          - registers: [62]
            enabled_lookup:
              io_mode_select: [Generator, Microinverter]
          - registers: [71]
          - operator: subtract
            registers: [77]
          - operator: subtract
            registers: [70]
          - operator: subtract
            registers: [84]

      - name: Total Losses
        description: Includes total consumption of the inverter device itself as well AC/DC conversion losses
        class: "energy"
        state_class: "total_increasing"
        ensure_increasing:
        uom: "kWh"
        rule: 3
        digits: 1
        scale: 0.1
        uint: enforce
        sensors:
          - registers: [78, 80]
          - registers: [96, 97]
          - registers: [92, 95]
            enabled_lookup:
              io_mode_select: [Generator, Microinverter]
          - registers: [74, 75]
          - operator: subtract
            registers: [81, 82]
          - operator: subtract
            registers: [72, 73]
          - operator: subtract
            registers: [85, 86]
        validation:
          min: 1

  - group: Battery
    items:
      - name: "Battery Temperature"
        class: "temperature"
        state_class: "measurement"
        uom: "°C"
        scale: 0.1
        rule: 1
        offset: 1000
        registers: [182]

      - name: "Battery Voltage"
        class: "voltage"
        state_class: "measurement"
        uom: "V"
        scale: 0.01
        rule: 1
        registers: [183]

      - name: "Battery"
        class: "battery"
        state_class: "measurement"
        uom: "%"
        rule: 1
        registers: [184]
        range:
          min: 0
          max: 100
        validation:
          min: 0
          max: 101
        attributes:
          [
            "Battery BMS SOC",
            "Battery BMS Current",
            "Battery BMS Voltage",
            "Battery BMS Other Symbol",
            "Battery BMS Charging Voltage",
            "Battery BMS Discharging Voltage",
            "Battery BMS Charging Current",
            "Battery BMS Discharging Current",
            "Battery BMS Max Charging Current",
            "Battery BMS Max Discharging Current",
          ]

      - name: "Battery State"
        description: Determines battery state from battery power by +-50 W
        class: "enum"
        rule: 0
        #rule: 1 # Not working???
        #registers: [189]
        #lookup: - key: 0 value: "charging" - key: 1 value: "idle" - key: 2 value: "discharging"
        options: ["charging", "idle", "discharging"]
        icon: "mdi:battery"

      - name: "Battery Power"
        class: "power"
        state_class: "measurement"
        uom: "W"
        rule: 2
        registers: [190]
        attributes: [inverse]

      - name: "Battery Current"
        class: "current"
        state_class: "measurement"
        uom: "A"
        scale: 0.01
        rule: 2
        registers: [191]
        icon: "mdi:current-dc"

      - name: "Battery Capacity"
        description: Estimates capacity of the battery during (dis)charging
        class: energy_storage
        state_class: measurement
        uom: "kWh"
        rule: 0
        digits: 1
        icon: "mdi:battery-check"

  - group: Grid
    items:
      - name: "Grid Frequency"
        l: 1
        class: "frequency"
        state_class: "measurement"
        uom: "Hz"
        scale: 0.01
        rule: 1
        registers: [79]

      - name: "Grid L1 Voltage"
        l: 1
        class: "voltage"
        state_class: "measurement"
        uom: "V"
        scale: 0.1
        rule: 1
        registers: [150]
        icon: "mdi:transmission-tower"

      - name: "Grid L2 Voltage"
        l: 2
        class: "voltage"
        state_class: "measurement"
        uom: "V"
        scale: 0.1
        rule: 1
        registers: [151]
        icon: "mdi:transmission-tower"

      - name: "Grid Voltage"
        l: 2
        class: "voltage"
        state_class: "measurement"
        uom: "V"
        scale: 0.1
        rule: 1
        registers: [152]
        icon: "mdi:transmission-tower"

      - name: "Grid L1 Current"
        l: 1
        class: "current"
        state_class: "measurement"
        uom: "A"
        scale: 0.01
        rule: 2
        registers: [160]
        icon: "mdi:transmission-tower"

      - name: "Grid L2 Current"
        l: 2
        class: "current"
        state_class: "measurement"
        uom: "A"
        scale: 0.01
        rule: 2
        registers: [161]
        icon: "mdi:transmission-tower"

      - name: "Grid L1 Power"
        l: 1
        class: "power"
        state_class: "measurement"
        uom: "W"
        rule: 2
        scale: [1, 10] # out of date docs
        registers: [167]
        icon: "mdi:transmission-tower"

      - name: "Grid L2 Power"
        l: 2
        class: "power"
        state_class: "measurement"
        uom: "W"
        rule: 2
        scale: [1, 10] # out of date docs
        registers: [168]
        icon: "mdi:transmission-tower"

      - name: "Grid Power"
        l: 1
        class: "power"
        state_class: "measurement"
        uom: "W"
        rule: 2
        scale: [1, 10] # out of date docs
        registers: [169]
        icon: "mdi:transmission-tower"
        attributes: [inverse]

      - name: "External CT1 Current"
        l: 1
        class: "current"
        state_class: "measurement"
        uom: "A"
        scale: 0.01
        rule: 2
        registers: [162]
        icon: "mdi:transmission-tower"

      - name: "External CT2 Current"
        l: 2
        class: "current"
        state_class: "measurement"
        uom: "A"
        scale: 0.01
        rule: 2
        registers: [163]
        icon: "mdi:transmission-tower"

      - name: "External CT1 Power"
        l: 1
        class: "power"
        state_class: "measurement"
        uom: "W"
        rule: 2
        scale: [1, 10] # out of date docs
        registers: [170]
        icon: "mdi:transmission-tower"

      - name: "External CT2 Power"
        l: 2
        class: "power"
        state_class: "measurement"
        uom: "W"
        rule: 2
        scale: [1, 10] # out of date docs
        registers: [171]
        icon: "mdi:transmission-tower"

      - name: "External Power"
        l: 1
        class: "power"
        state_class: "measurement"
        uom: "W"
        rule: 2
        scale: [1, 10] # out of date docs
        registers: [172]
        icon: "mdi:transmission-tower"

  - group: Load
    items:
      - name: "Load L1 Voltage"
        l: 1
        class: "voltage"
        state_class: "measurement"
        uom: "V"
        scale: 0.1
        rule: 1
        registers: [157]

      - name: "Load L2 Voltage"
        l: 2
        class: "voltage"
        state_class: "measurement"
        uom: "V"
        scale: 0.1
        rule: 1
        registers: [158]

      - name: "Load L1 Power"
        l: 1
        class: "power"
        state_class: "measurement"
        uom: "W"
        rule: 2
        scale: [1, 10] # out of date docs
        registers: [176]

      - name: "Load L2 Power"
        l: 2
        class: "power"
        state_class: "measurement"
        uom: "W"
        rule: 2
        scale: [1, 10] # out of date docs
        registers: [177]

      - name: "Load Power"
        l: 1
        class: "power"
        state_class: "measurement"
        uom: "W"
        rule: 2
        scale: [1, 10] # out of date docs
        registers: [178]

      - name: "Load L1 Current"
        l: 1
        class: "current"
        state_class: "measurement"
        uom: "A"
        scale: 0.01
        rule: 2
        registers: [179]

      - name: "Load L2 Current"
        l: 2
        class: "current"
        state_class: "measurement"
        uom: "A"
        scale: 0.01
        rule: 2
        registers: [180]

      - name: "Load Frequency"
        l: 1
        state_class: "measurement"
        uom: "Hz"
        scale: 0.01
        rule: 1
        registers: [192]

      - name: "Generator"
        description: Generator ready
        name_lookup: "io_mode_select"
        update_interval: 30
        platform: "binary_sensor"
        device_class: power
        rule: 1
        registers: [195]
        bit: 8

      - name: "Output Frequency"
        l: 1
        state_class: "measurement"
        uom: "Hz"
        scale: 0.01
        rule: 1
        registers: [193]

      - name: "Output L1 Voltage"
        l: 1
        class: "voltage"
        state_class: "measurement"
        uom: "V"
        scale: 0.1
        rule: 1
        registers: [154]
        icon: "mdi:transmission-tower"

      - name: "Output L2 Voltage"
        l: 2
        class: "voltage"
        state_class: "measurement"
        uom: "V"
        scale: 0.1
        rule: 1
        registers: [155]
        icon: "mdi:transmission-tower"

      - name: "Output Voltage"
        l: 2
        class: "voltage"
        state_class: "measurement"
        uom: "V"
        scale: 0.1
        rule: 1
        registers: [156]
        icon: "mdi:transmission-tower"

      - name: "Output L1 Current"
        l: 1
        class: "current"
        state_class: "measurement"
        uom: "A"
        scale: 0.01
        rule: 2
        registers: [164]

      - name: "Output L2 Current"
        l: 2
        class: "current"
        uom: "A"
        scale: 0.01
        rule: 2
        registers: [165]

      - name: "Output L1 Power"
        l: 1
        class: "power"
        state_class: "measurement"
        uom: "W"
        rule: 2
        registers: [173]

      - name: "Output L2 Power"
        l: 2
        class: "power"
        state_class: "measurement"
        uom: "W"
        rule: 2
        registers: [174]

      - name: "Power"
        class: "power"
        state_class: "measurement"
        uom: "W"
        rule: 2
        registers: [175]
        validation:
          lookup: "device_rated_power_sensor"
          scale: 1.1
          invalidate_all:

      - name: "Power losses"
        description: Includes consumption of the inverter device itself as well AC/DC conversion losses
        class: "power"
        state_class: "measurement"
        uom: "W"
        rule: 1
        digits: 0
        uint: enforce
        sensors:
          - registers: [186]
          - registers: [187]
          - signed:
            registers: [190]
          - operator: subtract
            signed:
            registers: [175]

      - name: "DC Temperature"
        class: "temperature"
        state_class: "measurement"
        uom: "°C"
        scale: 0.1
        rule: 2
        offset: 1000
        registers: [90]

      - name: "Temperature"
        class: "temperature"
        state_class: "measurement"
        uom: "°C"
        scale: 0.1
        rule: 2
        offset: 1000
        registers: [91]

      - name: "Grid"
        update_interval: 30
        platform: "binary_sensor"
        device_class: power
        rule: 1
        registers: [194]
        icon: "mdi:transmission-tower"

      - name: "Generator Power"
        name_lookup: "io_mode_select"
        class: "power"
        state_class: "measurement"
        uom: "W"
        rule: 1
        registers: [166]

      - name: "Generator Voltage"
        name_lookup: "io_mode_select"
        class: "voltage"
        state_class: "measurement"
        uom: "V"
        scale: 0.1
        rule: 1
        registers: [181]

      - name: "Generator Frequency"
        name_lookup: "io_mode_select"
        state_class: "measurement"
        uom: "Hz"
        scale: 0.01
        rule: 1
        registers: [196]

  - group: Settings
    update_interval: 300
    items:
      - name: "Battery Control Mode"
        platform: "select"
        rule: 1
        registers: [200]
        icon: "mdi:battery"
        lookup:
          - key: 0
            value: "Lead-Battery, four-stage charging method"
          - key: 1
            value: "Lithium"

      - name: "Battery Equalization"
        platform: number
        class: "voltage"
        state_class: "measurement"
        uom: "V"
        scale: 0.01
        rule: 1
        registers: [201]
        configurable:
          min: 38
          max: 61
          step: 0.1
          mode: box
        icon: "mdi:battery"
        range:
          min: 3800
          max: 6100

      - name: "Battery Absorption"
        platform: number
        class: "voltage"
        state_class: "measurement"
        uom: "V"
        scale: 0.01
        rule: 1
        registers: [202]
        configurable:
          min: 38
          max: 61
          step: 0.1
          mode: box
        icon: "mdi:battery"
        range:
          min: 3800
          max: 6100

      - name: "Battery Float"
        platform: number
        class: "voltage"
        state_class: "measurement"
        uom: "V"
        scale: 0.01
        rule: 1
        registers: [203]
        configurable:
          min: 38
          max: 61
          step: 0.1
          mode: box
        icon: "mdi:battery"
        range:
          min: 3800
          max: 6100

      - name: "Battery Capacity"
        platform: number
        state_class: "measurement"
        uom: "Ah"
        rule: 1
        registers: [204]
        icon: "mdi:battery"
        configurable:
          mode: box
        range:
          min: 0
          max: 2000

      - name: "Battery Empty"
        platform: number
        class: "voltage"
        state_class: "measurement"
        uom: "V"
        scale: 0.01
        rule: 1
        registers: [205]
        configurable:
          min: 38
          max: 61
          step: 0.1
          mode: box
        icon: "mdi:battery"

      - name: "Zero Export power"
        platform: number
        class: "power"
        state_class: "measurement"
        uom: "W"
        rule: 1
        registers: [206]
        range:
          min: 0
          max: 65535
        configurable:
          min: -20
          max: 500
        icon: "mdi:transmission-tower"

      - name: "Battery Equalization Cycle"
        platform: number
        class: "duration"
        state_class: "measurement"
        uom: "d"
        rule: 1
        registers: [207]
        icon: "mdi:battery"
        configurable:
          mode: box
        range:
          min: 0
          max: 90

      - name: "Battery Equalization Time"
        platform: number
        class: "duration"
        state_class: "measurement"
        uom: "h"
        scale: 0.5
        rule: 1
        registers: [208]
        configurable:
          min: 0
          max: 10
          mode: box
        icon: "mdi:battery"
        range:
          min: 0
          max: 20

      - name: "Battery Temperature Compensation"
        platform: number
        state_class: "measurement"
        uom: "mV/*C"
        rule: 2
        registers: [209]
        configurable:
          min: 0
          max: 50
          step: 0.1
        icon: "mdi:battery"
        range:
          min: 0
          max: 50

      - name: "Battery Max Charging Current"
        platform: number
        class: "current"
        state_class: "measurement"
        uom: "A"
        rule: 1
        registers: [210]
        icon: "mdi:current-dc"
        configurable:
          mode: box
        range:
          min: 0
          max: 240

      - name: "Battery Max Discharging Current"
        platform: number
        class: "current"
        state_class: "measurement"
        uom: "A"
        rule: 1
        registers: [211]
        icon: "mdi:current-dc"
        configurable:
          mode: box
        range:
          min: 0
          max: 240

      - name: "Battery Operation Mode"
        platform: "select"
        rule: 1
        registers: [213]
        icon: mdi:battery
        lookup:
          - key: 0
            value: Voltage
          - key: 1
            value: Capacity
          - key: 2
            value: No Battery

      - name: "Battery Wake Up"
        platform: "switch"
        rule: 1
        registers: [214]

      - name: Battery Resistance
        platform: number
        state_class: measurement
        uom: "mΩ"
        rule: 1
        registers: [215]
        icon: mdi:battery
        range:
          min: 0
          max: 6000

      - name: Battery Charging efficiency
        platform: number
        state_class: measurement
        uom: "%"
        scale: 0.1
        rule: 1
        registers: [216]
        icon: mdi:battery
        configurable:
          mode: box
        range:
          min: 0
          max: 1000
        validation:
          min: 0
          max: 100

      - name: Battery Shutdown SOC
        platform: number
        state_class: measurement
        uom: "%"
        rule: 1
        registers: [217]
        icon: mdi:battery
        configurable:
          mode: box
        range:
          min: 0
          max: 100

      - name: Battery Restart SOC
        platform: number
        state_class: measurement
        uom: "%"
        rule: 1
        registers: [218]
        icon: mdi:battery
        configurable:
          mode: box
        range:
          min: 0
          max: 100

      - name: Battery Low SOC
        platform: number
        state_class: measurement
        uom: "%"
        rule: 1
        registers: [219]
        icon: mdi:battery
        configurable:
          mode: box
        range:
          min: 0
          max: 100

      - name: Battery Shutdown Voltage
        platform: number
        class: "voltage"
        state_class: measurement
        uom: "V"
        scale: 0.01
        rule: 1
        registers: [220]
        icon: mdi:battery
        configurable:
          min: 38
          max: 61
          step: 0.1
          mode: box
        range:
          min: 3800
          max: 6100

      - name: Battery Restart Voltage
        platform: number
        class: "voltage"
        state_class: measurement
        uom: "V"
        scale: 0.01
        rule: 1
        registers: [221]
        icon: mdi:battery
        configurable:
          min: 38
          max: 61
          step: 0.1
          mode: box
        range:
          min: 3800
          max: 6100

      - name: Battery Low Voltage
        platform: number
        class: "voltage"
        state_class: measurement
        uom: "V"
        scale: 0.01
        rule: 1
        registers: [222]
        icon: mdi:battery
        configurable:
          min: 38
          max: 61
          step: 0.1
          mode: box
        range:
          min: 3800
          max: 6100

      - name: "Generator Operating Time"
        platform: number
        class: "duration"
        state_class: "measurement"
        uom: "h"
        scale: 0.1
        rule: 1
        registers: [223]
        icon: "mdi:generator-stationary"
        configurable:
          min: 0
          max: 24
          mode: box
        range:
          min: 0
          max: 240

      - name: "Generator Cooling Time"
        platform: number
        class: "duration"
        state_class: "measurement"
        uom: "h"
        scale: 0.1
        rule: 1
        registers: [224]
        icon: "mdi:generator-stationary"
        configurable:
          min: 0
          max: 24
          mode: box
        range:
          min: 0
          max: 240

      - name: Battery Generator Charging Start Voltage
        platform: number
        class: "voltage"
        state_class: measurement
        uom: "V"
        scale: 0.01
        rule: 1
        registers: [225]
        icon: mdi:battery
        configurable:
          min: 00
          max: 63
          step: 0.1
        range:
          min: 0000
          max: 6300

      - name: Battery Generator Charging Start
        platform: number
        state_class: measurement
        uom: "%"
        rule: 1
        registers: [226]
        icon: mdi:battery
        configurable:
          mode: box
        range:
          min: 0
          max: 100

      - name: "Battery Generator Charging Current"
        platform: number
        class: "current"
        state_class: "measurement"
        uom: "A"
        rule: 1
        registers: [227]
        icon: "mdi:current-dc"
        configurable:
          mode: box
        range:
          min: 0
          max: 240

      - name: "Battery Grid Charging Start Voltage"
        platform: number
        class: "voltage"
        state_class: measurement
        uom: "V"
        scale: 0.01
        rule: 1
        registers: [228]
        icon: "mdi:battery"
        configurable:
          min: 00
          max: 63
          step: 0.1
        range:
          min: 0000
          max: 6300

      - name: "Battery Grid Charging Start"
        platform: number
        state_class: measurement
        uom: "%"
        rule: 1
        registers: [229]
        icon: "mdi:battery"
        configurable:
          mode: box
        range:
          min: 0
          max: 100

      - name: "Battery Grid Charging Current"
        platform: number
        class: "current"
        state_class: "measurement"
        uom: "A"
        rule: 1
        registers: [230]
        icon: "mdi:current-dc"
        configurable:
          mode: box
        range:
          min: 0
          max: 240

      - name: "Battery Generator Charging"
        platform: "switch"
        rule: 1
        registers: [231]
        icon: "mdi:battery"

      - name: "Battery Grid Charging"
        platform: "switch"
        rule: 1
        registers: [232]
        icon: "mdi:battery"

      - name: "Generator"
        description: Gen Force
        name_lookup: "io_mode_select"
        platform: "switch"
        rule: 1
        registers: [326]
        value:
          bit: 13

      - name: "IO Mode"
        alt: Generator input mode
        description: The Generator/SmartLoad/Microinverter input-output mode
        platform: "select"
        rule: 1
        registers: [235]
        icon: "mdi:lightning-bolt-circle"
        lookup:
          - key: 0
            value: "Generator"
          - key: 1
            value: "SmartLoad"
          - key: 2
            value: "Microinverter"

      - name: "SmartLoad Off Voltage"
        platform: number
        class: "voltage"
        state_class: measurement
        uom: "V"
        scale: 0.01
        rule: 1
        registers: [236]
        icon: "mdi:battery"
        configurable:
          min: 38
          max: 63
          step: 0.1
          mode: box
        range:
          min: 3800
          max: 6300

      - name: "SmartLoad Off"
        platform: number
        state_class: "measurement"
        uom: "%"
        rule: 1
        registers: [237]
        icon: "mdi:lightning-bolt-circle"
        configurable:
          mode: box
        range:
          min: 0
          max: 100

      - name: "SmartLoad On Voltage"
        platform: number
        class: "voltage"
        state_class: measurement
        uom: "V"
        scale: 0.01
        rule: 1
        registers: [238]
        icon: "mdi:battery"
        configurable:
          min: 38
          max: 63
          step: 0.1
          mode: box
        range:
          min: 3800
          max: 6300

      - name: "SmartLoad On"
        platform: number
        state_class: "measurement"
        uom: "%"
        rule: 1
        registers: [239]
        icon: "mdi:lightning-bolt-circle"
        configurable:
          mode: box
        range:
          min: 0
          max: 100

  - group: Parameters
    update_interval: 300
    items:
      - name: "Generator Min PV Power"
        name_lookup: "io_mode_select"
        enabled_lookup:
          io_mode_select: [Generator, SmartLoad]
        platform: number
        class: "power"
        state_class: "measurement"
        uom: "W"
        rule: 1
        registers: [241]
        icon: "mdi:solar-power"
        range:
          min: 0000
          max: 8000

      - name: Charging Signal
        platform: "select"
        rule: 1
        registers: [242]
        lookup:
          - key: 0
            value: "Normal"
          - key: 1
            value: "Grid"
          - key: 2
            value: "Generator"
          - key: 3
            value: "Both"

  - group: Work Mode
    update_interval: 300
    items:
      - name: Energy Pattern
        platform: "select"
        rule: 1
        registers: [243]
        lookup:
          - key: 0
            value: "Battery First"
          - key: 1
            value: "Load First"

      - name: "Work Mode"
        platform: "select"
        rule: 1
        registers: [244]
        lookup:
          - key: 0
            value: "Export First"
          - key: 1
            value: "Zero Export To Load"
          - key: 2
            value: "Zero Export To CT"

      - name: Export Surplus Power
        alt: Max Sell Power
        platform: number
        class: "power"
        state_class: "measurement"
        uom: "W"
        rule: 1
        registers: [245]
        range:
          min: 0
          max: 12000

      - name: Export Surplus
        alt: Solar Sell
        platform: "switch"
        rule: 1
        registers: [247]

      - name: PV Power
        description: Max PV power limiter
        alt: Max Solar Power
        platform: number
        class: "power"
        state_class: "measurement"
        uom: "W"
        rule: 1
        registers: [53]
        icon: "mdi:solar-power-variant"
        range:
          min: 0
          max: 13000

      - name: Time of Use
        platform: select
        rule: 1
        registers: [248]
        lookup:
          - key: 0
            value: "Disabled"
          - key: 3
            value: "Monday"
          - key: 5
            value: "Tuesday"
          - key: 9
            value: "Wednesday"
          - key: 17
            value: "Thursday"
          - key: 33
            value: "Friday"
          - key: 65
            value: "Saturday"
          - key: 129
            value: "Sunday"
          - key: 63
            value: "Weekdays"
          - key: 193
            value: "Weekend"
          - key: 253
            value: "Week -Monday"
          - key: 251
            value: "Week -Tuesday"
          - key: 247
            value: "Week -Wednesday"
          - key: 239
            value: "Week -Thursday"
          - key: 223
            value: "Week -Friday"
          - key: 191
            value: "Week -Saturday"
          - key: 127
            value: "Week -Sunday"
          - key: 255
            value: "Week"
          - bit: 0
            mode: "|"
            value: "Enabled"

      - name: "Program 1 Time"
        platform: "time"
        state_class: measurement
        rule: 9
        registers: [250]
        range:
          min: 0000
          max: 2359
        icon: mdi:sun-clock

      - name: "Program 2 Time"
        platform: "time"
        state_class: measurement
        rule: 9
        registers: [251]
        range:
          min: 0000
          max: 2359
        icon: mdi:sun-clock

      - name: "Program 3 Time"
        platform: "time"
        state_class: measurement
        rule: 9
        registers: [252]
        range:
          min: 0000
          max: 2359
        icon: mdi:sun-clock

      - name: "Program 4 Time"
        platform: "time"
        state_class: measurement
        rule: 9
        registers: [253]
        range:
          min: 0000
          max: 2359
        icon: mdi:sun-clock

      - name: "Program 5 Time"
        platform: "time"
        state_class: measurement
        rule: 9
        registers: [254]
        range:
          min: 0000
          max: 2359
        icon: mdi:sun-clock

      - name: "Program 6 Time"
        platform: "time"
        state_class: measurement
        rule: 9
        registers: [255]
        range:
          min: 0000
          max: 2359
        icon: mdi:sun-clock

      - name: "Program 1 Power"
        platform: number
        class: "power"
        state_class: measurement
        uom: "W"
        rule: 1
        registers: [256]
        range:
          min: 0000
          max: 12000
        icon: mdi:sun-clock

      - name: "Program 2 Power"
        platform: number
        class: "power"
        state_class: measurement
        uom: "W"
        rule: 1
        registers: [257]
        range:
          min: 0000
          max: 12000
        icon: mdi:sun-clock

      - name: "Program 3 Power"
        platform: number
        class: "power"
        state_class: measurement
        uom: "W"
        rule: 1
        registers: [258]
        range:
          min: 0000
          max: 12000
        icon: mdi:sun-clock

      - name: "Program 4 Power"
        platform: number
        class: "power"
        state_class: measurement
        uom: "W"
        rule: 1
        registers: [259]
        range:
          min: 0000
          max: 12000
        icon: mdi:sun-clock

      - name: "Program 5 Power"
        platform: number
        class: "power"
        state_class: measurement
        uom: "W"
        rule: 1
        registers: [260]
        range:
          min: 0000
          max: 12000
        icon: mdi:sun-clock

      - name: "Program 6 Power"
        platform: number
        class: "power"
        state_class: measurement
        uom: "W"
        rule: 1
        registers: [261]
        range:
          min: 0000
          max: 12000
        icon: mdi:sun-clock

      - name: Program 1 Voltage
        platform: number
        class: "voltage"
        state_class: measurement
        uom: "V"
        scale: 0.01
        rule: 1
        registers: [262]
        configurable:
          min: 00
          max: 61
          step: 0.1
          mode: box
        range:
          min: 0000
          max: 6100
        icon: mdi:sun-clock

      - name: Program 2 Voltage
        platform: number
        class: "voltage"
        state_class: measurement
        uom: "V"
        scale: 0.01
        rule: 1
        registers: [263]
        configurable:
          min: 00
          max: 61
          step: 0.1
          mode: box
        range:
          min: 0000
          max: 6100
        icon: mdi:sun-clock

      - name: Program 3 Voltage
        platform: number
        class: "voltage"
        state_class: measurement
        uom: "V"
        scale: 0.01
        rule: 1
        registers: [264]
        configurable:
          min: 00
          max: 61
          step: 0.1
          mode: box
        range:
          min: 0000
          max: 6100
        icon: mdi:sun-clock

      - name: Program 4 Voltage
        platform: number
        class: "voltage"
        state_class: measurement
        uom: "V"
        scale: 0.01
        rule: 1
        registers: [265]
        configurable:
          min: 00
          max: 61
          step: 0.1
          mode: box
        range:
          min: 0000
          max: 6100
        icon: mdi:sun-clock

      - name: Program 5 Voltage
        platform: number
        class: "voltage"
        state_class: measurement
        uom: "V"
        scale: 0.01
        rule: 1
        registers: [266]
        configurable:
          min: 00
          max: 61
          step: 0.1
          mode: box
        range:
          min: 0000
          max: 6100
        icon: mdi:sun-clock

      - name: Program 6 Voltage
        platform: number
        class: "voltage"
        state_class: measurement
        uom: "V"
        scale: 0.01
        rule: 1
        registers: [267]
        configurable:
          min: 00
          max: 61
          step: 0.1
          mode: box
        range:
          min: 0000
          max: 6100
        icon: mdi:sun-clock

      - name: "Program 1 SOC"
        platform: number
        state_class: measurement
        uom: "%"
        rule: 1
        registers: [268]
        configurable:
          mode: box
        range:
          min: 0
          max: 100
        icon: mdi:sun-clock

      - name: "Program 2 SOC"
        platform: number
        state_class: measurement
        uom: "%"
        rule: 1
        registers: [269]
        configurable:
          mode: box
        range:
          min: 0
          max: 100
        icon: mdi:sun-clock

      - name: "Program 3 SOC"
        platform: number
        state_class: measurement
        uom: "%"
        rule: 1
        registers: [270]
        configurable:
          mode: box
        range:
          min: 0
          max: 100
        icon: mdi:sun-clock

      - name: "Program 4 SOC"
        platform: number
        state_class: measurement
        uom: "%"
        rule: 1
        registers: [271]
        configurable:
          mode: box
        range:
          min: 0
          max: 100
        icon: mdi:sun-clock

      - name: "Program 5 SOC"
        platform: number
        state_class: measurement
        uom: "%"
        rule: 1
        registers: [272]
        configurable:
          mode: box
        range:
          min: 0
          max: 100
        icon: mdi:sun-clock

      - name: "Program 6 SOC"
        platform: number
        state_class: measurement
        uom: "%"
        rule: 1
        registers: [273]
        configurable:
          mode: box
        range:
          min: 0
          max: 100
        icon: mdi:sun-clock

      - name: Program 1 Charging
        platform: select
        rule: 1
        registers: [274]
        display:
          mask: 0x3
        icon: mdi:sun-clock
        lookup:
          - key: 0
            value: "Disabled"
          - key: 1
            value: "Grid"
          - key: 2
            value: "Generator"
          - key: 3
            value: "Both"

      - name: Program 2 Charging
        platform: select
        rule: 1
        registers: [275]
        display:
          mask: 0x3
        icon: mdi:sun-clock
        lookup:
          - key: 0
            value: "Disabled"
          - key: 1
            value: "Grid"
          - key: 2
            value: "Generator"
          - key: 3
            value: "Both"

      - name: Program 3 Charging
        platform: select
        rule: 1
        registers: [276]
        display:
          mask: 0x3
        icon: mdi:sun-clock
        lookup:
          - key: 0
            value: "Disabled"
          - key: 1
            value: "Grid"
          - key: 2
            value: "Generator"
          - key: 3
            value: "Both"

      - name: Program 4 Charging
        platform: select
        rule: 1
        registers: [277]
        display:
          mask: 0x3
        icon: mdi:sun-clock
        lookup:
          - key: 0
            value: "Disabled"
          - key: 1
            value: "Grid"
          - key: 2
            value: "Generator"
          - key: 3
            value: "Both"

      - name: Program 5 Charging
        platform: select
        rule: 1
        registers: [278]
        display:
          mask: 0x3
        icon: mdi:sun-clock
        lookup:
          - key: 0
            value: "Disabled"
          - key: 1
            value: "Grid"
          - key: 2
            value: "Generator"
          - key: 3
            value: "Both"

      - name: Program 6 Charging
        platform: select
        rule: 1
        registers: [279]
        display:
          mask: 0x3
        icon: mdi:sun-clock
        lookup:
          - key: 0
            value: "Disabled"
          - key: 1
            value: "Grid"
          - key: 2
            value: "Generator"
          - key: 3
            value: "Both"

      - name: Microinverter Export cut-off
        platform: "switch"
        rule: 1
        registers: [280]
        value:
          bit: 0

      - name: Generator Peak shaving
        platform: "switch"
        rule: 1
        registers: [280]
        value:
          bit: 4

      - name: Grid Peak shaving
        platform: "switch"
        rule: 1
        registers: [280]
        value:
          bit: 8

      - name: Generator On-Grid
        description: On Grid always on
        name_lookup: io_mode_select
        enabled_lookup:
          io_mode_select: [Generator, SmartLoad]
        platform: "switch"
        rule: 1
        registers: [280]
        value:
          bit: 12

      - name: Off Grid
        platform: switch
        rule: 1
        range:
          min: 0
          max: 1
        registers: [281]

      - name: Grid reconnection time
        platform: number
        rule: 1
        range:
          min: 1
          max: 300
        registers: [282]

      - name: Grid frequency
        platform: "select"
        rule: 1
        registers: [285]
        lookup:
          - key: 0
            value: 50 Hz
          - key: 1
            value: 60 Hz

      - name: "Grid voltage protection - high"
        platform: number
        class: "voltage"
        uom: "V"
        scale: 0.1
        rule: 1
        registers: [287]
        configurable:
          mode: box
        range:
          min: 1000
          max: 2900

      - name: "Grid voltage protection - low"
        platform: number
        class: "voltage"
        uom: "V"
        scale: 0.1
        rule: 1
        registers: [288]
        configurable:
          mode: box
        range:
          min: 1000
          max: 2900

      - name: "Grid frequency protection - high"
        platform: number
        class: "frequency"
        uom: "Hz"
        scale: 0.01
        rule: 1
        registers: [289]
        configurable:
          mode: box
        range:
          min: 4500
          max: 6500

      - name: "Grid frequency protection - low"
        platform: number
        class: "frequency"
        uom: "Hz"
        scale: 0.01
        rule: 1
        registers: [290]
        configurable:
          mode: box
        range:
          min: 4500
          max: 6500

      - name: Generator Grid side
        description: The generator is connected to the grid input
        platform: "switch"
        rule: 1
        registers: [291]

      - name: "Generator Peak shaving"
        platform: number
        class: "power"
        uom: "W"
        rule: 1
        registers: [292]
        icon: "mdi:generator-stationary"
        range:
          min: 0
          max: 22000

      - name: "Grid Peak shaving"
        platform: number
        class: "power"
        uom: "W"
        rule: 1
        registers: [293]
        icon: "mdi:transmission-tower"
        range:
          min: 0
          max: 22000

      - name: Battery BMS Type
        platform: select
        rule: 1
        registers: [325]
        icon: "mdi:battery"
        lookup:
          - key: 0
            value: "PYLON"
          - key: 1
            value: "Tianbangda"
          - key: 2
            value: "KOK"
          - key: 3
            value: "Keith"
          - key: 4
            value: "Toppai"
          - key: 5
            value: "Peneng 485"
          - key: 6
            value: "Jeris 485"
          - key: 7
            value: "Sunwoda 485"
          - key: 8
            value: "Xinrui 485"
          - key: 9
            value: "Tianbangda 485"
          - key: 10
            value: "Shenggao Electric CAN"

      - name: "Meter"
        description: Ex_Meter For CT
        platform: "switch"
        rule: 1
        registers: [326]

      - name: AC Coupling
        description: Couple inverters and batteries using AC lines
        platform: "select"
        rule: 1
        registers: [326]
        lookup:
          - bit: 0
            mode: "|"
            value: Disabled
          - bit: 6
            mode: "|"
            value: Grid
          - bit: 7
            mode: "|"
            value: Load

  - group: BMS
    update_interval: 60
    items:
      - name: "Battery BMS Charging Voltage"
        attribute:
        class: "voltage"
        state_class: "measurement"
        uom: "V"
        scale: 0.01
        rule: 1
        registers: [312]

      - name: "Battery BMS Discharging Voltage"
        attribute:
        class: "voltage"
        state_class: "measurement"
        uom: "V"
        scale: 0.01
        rule: 1
        registers: [313]

      - name: "Battery BMS Charging Current"
        attribute:
        class: "current"
        state_class: "measurement"
        uom: "A"
        rule: 1
        registers: [314]
        icon: "mdi:current-dc"

      - name: "Battery BMS Discharging Current"
        attribute:
        class: "current"
        state_class: "measurement"
        uom: "A"
        rule: 1
        registers: [315]
        icon: "mdi:current-dc"

      - name: "Battery BMS SOC"
        attribute:
        state_class: "measurement"
        uom: "%"
        rule: 1
        registers: [316]
        icon: "mdi:battery"
        validation:
          min: 0
          max: 101

      - name: "Battery BMS Voltage"
        attribute:
        class: "voltage"
        state_class: "measurement"
        uom: "V"
        scale: 0.01
        rule: 1
        registers: [317]

      - name: "Battery BMS Current"
        attribute:
        class: "current"
        state_class: "measurement"
        uom: "A"
        rule: 2
        registers: [318]
        icon: "mdi:current-dc"

      - name: "Battery BMS Max Charging Current"
        attribute:
        class: "current"
        state_class: "measurement"
        uom: "A"
        rule: 1
        registers: [320]
        icon: "mdi:current-dc"

      - name: "Battery BMS Max Discharging Current"
        attribute:
        class: "current"
        state_class: "measurement"
        uom: "A"
        rule: 1
        registers: [321]
        icon: "mdi:current-dc"

      - name: "Battery Alarm"
        platform: binary_sensor
        class: "problem"
        rule: 1
        registers: [322]
        icon: "mdi:battery-alert"
        attributes: ["value"]

      - name: "Battery Fault"
        platform: binary_sensor
        class: "problem"
        rule: 1
        registers: [323]
        icon: "mdi:battery-alert-variant"
        range:
          min: 0
          max: 65535
        attributes: ["value"]

      - name: "Battery BMS Other Symbol"
        attribute:
        rule: 1
        registers: [324]
        icon: "mdi:battery-unknown"
        range:
          min: 0
          max: 65535
        lookup:
          - key: 0
            value: "OK"
          - bit: 0
            value: "Vacancy"
          - bit: 1
            value: "OCP"
